#include <stdio.h>
#include <stdint.h>

#define BLOCK_SIZE_64 8
#define BLOCK_SIZE_128 16

void generateSubKeys(uint8_t *key, int keySize, uint8_t *subKey1, uint8_t *subKey2) {
    // Apply block cipher to block of all zeros
    uint8_t zeroBlock[BLOCK_SIZE_128] = {0}; // Assuming the largest block size for simplicity
    uint8_t cipher[BLOCK_SIZE_128] = {0}; // Resulting cipher

    // Simulating block cipher, replace this with your actual block cipher function
    // For simplicity, here we assume the block cipher function just copies the input to the output
    for (int i = 0; i < BLOCK_SIZE_128; ++i) {
        cipher[i] = zeroBlock[i];
    }

    // Left shift by one bit
    int carry = 0;
    for (int i = 0; i < BLOCK_SIZE_128; ++i) {
        int newCarry = (cipher[i] & 0x80) >> 7;
        cipher[i] = (cipher[i] << 1) | carry;
        carry = newCarry;
    }

    // XOR with constant based on block size
    if (keySize == BLOCK_SIZE_64) {
        // Constants for block size of 64 bits
        uint8_t constant[BLOCK_SIZE_64] = {0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B};
        for (int i = 0; i < BLOCK_SIZE_64; ++i) {
            subKey1[i] = cipher[i] ^ constant[i];
        }
    } else if (keySize == BLOCK_SIZE_128) {
        // Constants for block size of 128 bits
        uint8_t constant[BLOCK_SIZE_128] = {
            0x87, 0x87, 0x87, 0x87, 0x87, 0x87, 0x87, 0x87,
            0x87, 0x87, 0x87, 0x87, 0x87, 0x87, 0x87, 0x87
        };
        for (int i = 0; i < BLOCK_SIZE_128; ++i) {
            subKey1[i] = cipher[i] ^ constant[i];
        }
    }

    // Derive second subkey from first subkey using the same process
    carry = (subKey1[0] & 0x80) >> 7;
    for (int i = 0; i < keySize; ++i) {
        int newCarry = (subKey1[i] & 0x80) >> 7;
        subKey2[i] = (subKey1[i] << 1) | carry;
        carry = newCarry;
    }
}

int main() {
    uint8_t key64[BLOCK_SIZE_64] = {0}; // 64-bit key
    uint8_t subKey1_64[BLOCK_SIZE_64];
    uint8_t subKey2_64[BLOCK_SIZE_64];

    uint8_t key128[BLOCK_SIZE_128] = {0}; // 128-bit key
    uint8_t subKey1_128[BLOCK_SIZE_128];
    uint8_t subKey2_128[BLOCK_SIZE_128];

    // Generate subkeys
    generateSubKeys(key64, BLOCK_SIZE_64, subKey1_64, subKey2_64);
    generateSubKeys(key128, BLOCK_SIZE_128, subKey1_128, subKey2_128);

    // Output the subkeys for verification
    printf("Subkey 1 (64-bit):\n");
    for (int i = 0; i < BLOCK_SIZE_64; ++i) {
        printf("%02X ", subKey1_64[i]);
    }
    printf("\n");

    printf("Subkey 2 (64-bit):\n");
    for (int i = 0; i < BLOCK_SIZE_64; ++i) {
        printf("%02X ", subKey2_64[i]);
    }
    printf("\n");

    printf("Subkey 1 (128-bit):\n");
    for (int i = 0; i < BLOCK_SIZE_128; ++i) {
        printf("%02X ", subKey1_128[i]);
    }
    printf("\n");

    printf("Subkey 2 (128-bit):\n");
    for (int i = 0; i < BLOCK_SIZE_128; ++i) {
        printf("%02X ", subKey2_128[i]);
    }
    printf("\n");

    return 0;
}
